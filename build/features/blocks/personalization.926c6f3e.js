!function(e,t){for(var n in t)e[n]=t[n]}(this,function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=47)}([function(e,t){!function(){e.exports=this.React}()},,,function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){var r=n(11),i=n(12),o=n(8),a=n(13);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()}},function(e,t,n){e.exports=n(19)},function(e,t,n){var r=n(20),i=n(21),o=n(8),a=n(22);e.exports=function(e){return r(e)||i(e)||o(e)||a()}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){var r=n(9);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},,function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},,,,,,function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),a=new O(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===u)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function f(){}function d(){}var v={};v[i]=function(){return this};var m=Object.getPrototypeOf,y=m&&m(m(k([])));y&&y!==t&&n.call(y,i)&&(v=y);var h=d.prototype=p.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,c){var l=s(e[i],e,o);if("throw"!==l.type){var u=l.arg,p=u.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,c)}))}c(l.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return f.prototype=h.constructor=d,d.constructor=f,f.displayName=c(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},b(g.prototype),g.prototype[o]=function(){return this},e.AsyncIterator=g,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new g(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(h),c(h,a,"Generator"),h[i]=function(){return this},h.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){var r=n(9);e.exports=function(e){if(Array.isArray(e))return r(e)}},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},,,,,function(e){e.exports=JSON.parse('{"name":"altis/personalization","settings":{"category":"altis-experience-blocks","icon":"groups","supports":{"alignWide":true,"html":false,"align":true},"attributes":{"clientId":{"type":"string","required":true}}}}')},,,,,,function(e,t,n){var r=n(42);e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}},,,,,,,,,function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}},,,,,function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r),o=n(4),a=n.n(o),c=n(0),l=n.n(c),s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),u=new Uint8Array(16);function p(){if(!s)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(u)}var f=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var d=function(e){return"string"==typeof e&&f.test(e)},v=[],m=0;m<256;++m)v.push((m+256).toString(16).substr(1));var y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]).toLowerCase();if(!d(n))throw TypeError("Stringified UUID is invalid");return n};var h=function(e,t,n){var r=(e=e||{}).random||(e.rng||p)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return y(r)},b=wp.components.Icon,g=wp.i18n,w=g.__,x=g._n,E=g.sprintf,O=function(e){var t=e.conversions,n=void 0===t?null:t,r=e.conversionsLabel,i=void 0===r?null:r,o=e.isLoading,a=e.label,c=void 0===a?null:a,s=e.total,u=e.uniques;return u&&s||!o?u&&s?l.a.createElement("div",{className:"altis-analytics-views"},l.a.createElement("div",{className:"altis-analytics-views__total"},l.a.createElement(b,{icon:"visibility"}),c||E(x("%d unique view, %d total","%d unique views, %d total",u,"altis-experiments"),u,s)),null!==n&&l.a.createElement("div",{className:"altis-analytics-views__conversions"},l.a.createElement(b,{icon:"yes"}),i||E(x("%d conversion","%d conversions",n,"altis-experiments"),n)," ","(",(n/u*100).toFixed(1),"%)")):l.a.createElement("p",{className:"altis-analytics-views"},l.a.createElement(b,{icon:"visibility"})," ",w("No views yet","altis-experiments")):l.a.createElement("p",{className:"altis-analytics-views"},l.a.createElement(b,{icon:"visibility"})," ",w("Loading...","altis-experiments"))},k=wp.data.useSelect,I=wp.i18n,j=I.__,S=I.sprintf,_=function(e){var t=e.clientId,n=k((function(e){return e("core/editor").getCurrentPostId()})),r=k((function(e){return e("analytics/xbs").getViews(t,n)}),[t,n]),i=k((function(e){return e("analytics/xbs").getIsLoading()}),[r]);if(!n)return null;var o=r&&r.loads||0,a=r&&r.views||0,c=r&&r.unique&&r.unique.loads||0,s=r&&r.unique&&r.unique.views||0;return l.a.createElement("div",{className:"altis-experience-block-analytics"},l.a.createElement("h4",null,j("Block Insights","altis-experiments")),l.a.createElement("p",null,j("Statistics shown are for the configured data retention period.","altis-experiments")),l.a.createElement(O,{conversions:s,conversionsLabel:S(j("%d unique block views, %d total","altis-experiments"),s,a),isLoading:i,label:S(j("%d unique page views, %d total","altis-experiments"),c,o),total:o,uniques:c}))},L=n(7),P=n.n(L),C=wp.data.useSelect,N=wp.i18n.__,A=function(e){var t=e.variant,n=e.placeholder,r=void 0===n?null:n;if(!t||"object"!==P()(t))return"";var i=C((function(e){return e("audience").getPost(t.attributes.audience)}),[t.attributes.audience]),o=C((function(e){return e("audience").getIsLoading()}),[]);if(t.attributes.fallback)return N("Fallback","altis-experiments");if(!t.attributes.audience)return r||N("Select audience","altis-experiments");var a=i&&i.status||"draft",c=i&&i.title&&i.title.rendered;return"trash"!==a&&c?i.title.rendered:"trash"===a?N("(deleted)","altis-experiments"):i&&i.error&&i.error.message?i.error.message:o?N("Loading...","altis-experiments"):""},V=n(6),B=n.n(V),R=wp.components.SelectControl,D=wp.i18n.__,T=window.Altis.Analytics.Experiments.Goals||{},q=function(e){var t=e.goal,n=e.onChange,r=Object.entries(T);if(r.length<1)return null;var i=[{label:D("Impressions","altis-experiments"),value:""}].concat(B()(r.map((function(e){var t=a()(e,2),n=t[0];return{label:t[1].label||n,value:n}}))));return l.a.createElement(R,{label:D("Choose a conversion goal","altis-experiments"),onChange:n,options:i,value:t})},F=wp.data.useSelect,G=wp.i18n,M=G._n,z=G.sprintf,U=function(e){var t=e.variant,n=t.attributes,r=n.audience,i=n.fallback,o=F((function(e){return e("core/editor").getCurrentPostId()})),a=F((function(e){var n=e("core/block-editor");return(0,n.getBlockAttributes)((0,n.getBlockRootClientId)(t.clientId)).clientId}),[t.clientId]),c=F((function(e){return e("analytics/xbs").getViews(a,o)}),[a,o]),s=F((function(e){return e("analytics/xbs").getIsLoading()}),[c]);if(!i&&!r)return null;if(!o)return null;var u=r||0,p=(c&&c.audiences||[]).find((function(e){return e.id===u}))||{unique:{}};return t.attributes.goal?l.a.createElement(O,{conversions:p.unique.conversions,isLoading:s,total:p.views,uniques:p.unique.views}):l.a.createElement(O,{isLoading:s,label:z(M("%d unique view, %d total","%d unique views, %d total",p.unique.views,"altis-experiments"),p.unique.views,p.views),total:p.views,uniques:p.unique.views})},W=Altis.Analytics.components.AudiencePicker,Y=wp.components.PanelBody,H=wp.data.useDispatch,J=wp.i18n.__,$=function(e){var t=e.variant,n=e.placeholder,r=void 0===n?null:n,i=H("core/block-editor").updateBlockAttributes;return t.attributes.fallback?l.a.createElement(Y,{title:J("Fallback","altis-experiments")},l.a.createElement("p",{className:"description"},J("This variant will be shown as a fallback if no audiences are matched.","altis-experiments")),l.a.createElement(q,{goal:t.attributes.goal,onChange:function(e){return i(t.clientId,{goal:e})}}),l.a.createElement(U,{variant:t})):l.a.createElement(Y,{title:l.a.createElement(A,{variant:t,placeholder:r})},l.a.createElement(W,{audience:t.attributes.audience,onSelect:function(e){return i(t.clientId,{audience:e})},onClearSelection:function(){return i(t.clientId,{audience:null})}}),!t.attributes.audience&&l.a.createElement("p",{className:"description"},J("You must select an audience for this variant.","altis-experiments")),l.a.createElement(q,{goal:t.attributes.goal,onChange:function(e){return i(t.clientId,{goal:e})}}),l.a.createElement(U,{variant:t}))},Q=wp.components.IconButton,K=wp.i18n.__,X=function(e){var t=e.canRemove,n=e.isFallback,r=e.onCopy,i=e.onRemove;return l.a.createElement("div",{className:"altis-experience-block-header__toolbar"},l.a.createElement(Q,{icon:"migrate",title:K("Copy variant","altis-experiments"),onClick:r},K("Copy","altis-experiments")),!n&&l.a.createElement(Q,{disabled:!t,icon:"trash",title:K("Remove variant","altis-experiments"),onClick:i}))};function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te=wp.blocks,ne=te.createBlock,re=te.cloneBlock,ie=wp.compose.compose,oe=wp.data,ae=oe.withSelect,ce=oe.withDispatch,le=function(e){return ie(ae((function(e,t){var n=t.clientId;return{variants:(0,e("core/block-editor").getBlocks)(n)}})),ce((function(e,t,n){return{onAddVariant:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.clientId,o=e("core/block-editor"),a=o.replaceInnerBlocks,c=o.selectBlock,l=n.select("core/block-editor"),s=l.getBlocks,u=ne("altis/personalization-variant",ee({audience:null,fallback:!1,goal:""},r),[]),p=[u].concat(B()(s(i)));return a(i,p),c(i),u.clientId},onCopyVariant:function(t){var r=e("core/block-editor").replaceInnerBlocks,i=n.select("core/block-editor"),o=i.getBlock,a=i.getBlocks,c=i.getBlockRootClientId,l=o(t),s=re(l,{audience:null,fallback:!1}),u=c(t),p=a(u),f=p.findIndex((function(e){return e.clientId===t})),d=l.attributes.fallback?f:f+1;return r(u,[].concat(B()(p.slice(0,d)),[s],B()(p.slice(d)))),s.clientId},onRemoveVariant:function(r){var i=t.clientId,o=t.attributes,a=e("core/block-editor").replaceInnerBlocks,c=n.select("core/block-editor").getBlocks;o.fallback||a(i,c(i).filter((function(e){return e.clientId!==r})))}}})))(e)},se=wp.blockEditor,ue=se.BlockControls,pe=se.InnerBlocks,fe=se.InspectorControls,de=wp.components,ve=de.Button,me=de.PanelBody,ye=de.Toolbar,he=wp.i18n,be=he.__,ge=he.sprintf,we=["altis/personalization-variant"],xe=le((function(e){var t=e.attributes,n=e.className,r=e.clientId,i=e.isSelected,o=e.onAddVariant,s=e.onCopyVariant,u=e.onRemoveVariant,p=e.setAttributes,f=e.variants;Object(c.useEffect)((function(){t.clientId||p({clientId:h()})}),[]);var d=f.length>0&&f[0].clientId||null,v=Object(c.useState)(d),m=a()(v,2),y=m[0],b=m[1],g=Object(c.useState)(),w=a()(g,2),x=w[0],E=w[1];Object(c.useEffect)((function(){0===f.length&&b(o({fallback:!0}))}),[]);var O=f.findIndex((function(e){return e.clientId===y})),k=[{icon:"plus",title:be("Add a variant","altis-experiments"),className:"altis-add-variant-button",onClick:function(){return b(o())}}];return l.a.createElement(c.Fragment,null,l.a.createElement(ue,null,l.a.createElement(ye,{className:"altis-variants-toolbar",controls:k},l.a.createElement("div",{className:"altis-variants-toolbar__tabs"},f.map((function(e,t){return l.a.createElement(ve,{key:"variant-select-".concat(e.clientId),className:"altis-variant-button components-icon-button has-text ".concat(y===e.clientId&&"is-active"),title:be("Select variant","altis-experiments"),onClick:function(){return b(e.clientId)}},l.a.createElement(A,{variant:e,placeholder:ge(be("Variant %d","altis-experiments"),t+1)}))}))))),l.a.createElement(fe,null,l.a.createElement("div",{className:"components-panel__body is-opened"},l.a.createElement(_,{clientId:t.clientId}),l.a.createElement(ve,{onClick:function(){return b(o())},isSecondary:!0},be("Add a variant","altis-experiments"))),f.map((function(e,t){return l.a.createElement($,{className:"variant-settings-".concat(e.clientId),key:"variant-settings-".concat(e.clientId),variant:e,placeholder:ge(be("Variant %d","altis-experiments"),t+1)})})),l.a.createElement(me,{title:be("Reset Analytics Data","altis-experiments")},l.a.createElement("p",null,l.a.createElement("em",null,be("Editing an experience block may make the existing analytics data meaningless, for example when changing conversion goals or making significant changes to the content."))),l.a.createElement("p",null,be("You can reset the tracking data for this block to ensure it is relevant by clicking the button below.")),l.a.createElement(ve,{isDestructive:!0,onClick:function(){E(t.clientId),p({clientId:h()})}},be("Reset","altis-experiments"))," ",x&&l.a.createElement(ve,{isTertiary:!0,isLink:!0,onClick:function(){E(null),p({clientId:x})}},be("Undo","altis-experiments")))),l.a.createElement("style",{dangerouslySetInnerHTML:{__html:'\n\t\t\t\t\t[data-block="'.concat(r,'"] [data-type="altis/personalization-variant"] {\n\t\t\t\t\t\tdisplay: none;\n\t\t\t\t\t}\n\t\t\t\t\t[data-block="').concat(r,'"] [data-type="altis/personalization-variant"][data-block="').concat(y,'"] {\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\t\t\t\t')}}),l.a.createElement("div",{className:n},l.a.createElement("div",{className:"wp-core-ui altis-experience-block-header"},l.a.createElement("span",{className:"altis-experience-block-header__title"},be("Personalized Content","altis-experiments")," ・ ",f.length>0&&l.a.createElement(A,{variant:f[O],placeholder:ge(be("Variant %d","altis-experiments"),O+1)})),i&&l.a.createElement(X,{canRemove:f.length>1,isFallback:y&&f[O].attributes.fallback,onCopy:function(){return b(s(y))},onRemove:function(){b(0===O?f[O+1].clientId:f[O-1].clientId),u(y)}})),l.a.createElement(pe,{allowedBlocks:we,renderAppender:!1})))})),Ee=wp.blockEditor.InnerBlocks,Oe=function(){return l.a.createElement(Ee.Content,null)},ke=n(5),Ie=n.n(ke),je=n(33),Se=n.n(je);function _e(e){var t=function(e,t){if("object"!==P()(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==P()(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===P()(t)?t:String(t)}function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ce=wp.apiFetch,Ne=wp.data.registerStore,Ae=wp.url.addQueryArgs,Ve={FETCH_FROM_API:function(e){return Ce(e.options)},RESPONSE_TO_JSON:function(e){return e.response.json()}},Be={addViews:function(e,t,n){return{type:"ADD_VIEWS",clientId:e,postId:t,views:n}},removeViews:function(e,t){return{type:"REMOVE_VIEWS",clientId:e,postId:t}},setIsLoading:function(e){return{type:"SET_IS_LOADING",isLoading:e}},fetch:function(e){return{type:"FETCH_FROM_API",options:e}},json:function(e){return{type:"RESPONSE_TO_JSON",response:e}}},Re={getViews:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.views["".concat(t).concat(n?"-".concat(n):"")]||!1},getIsLoading:function(e){return e.isLoading}},De={getViews:Ie.a.mark((function e(t){var n,r,i=arguments;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:null,e.next=3,Be.setIsLoading(!0);case 3:return e.next=5,Be.fetch({path:Ae("analytics/v1/xbs/".concat(t,"/views"),{post_id:n})});case 5:return r=e.sent,e.next=8,Be.addViews(t,n,r);case 8:return e.abrupt("return",Be.setIsLoading(!1));case 9:case"end":return e.stop()}}),e)}))},Te=(Ne("analytics/xbs",{actions:Be,controls:Ve,initialState:{views:{},isLoading:!1},reducer:function(e,t){switch(t.type){case"ADD_VIEWS":var n="".concat(t.clientId).concat(t.postId?"-".concat(t.postId):"");return Pe(Pe({},e),{},{views:Pe(Pe({},e.views),{},i()({},n,t.views))});case"REMOVE_VIEWS":var r="".concat(t.clientId).concat(t.postId?"-".concat(t.postId):"");e[r];return Se()(e,[r].map(_e));case"SET_IS_LOADING":return Pe(Pe({},e),{},{isLoading:t.isLoading});default:return e}},resolvers:De,selectors:Re}),n(27));function qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Fe=wp.blocks.registerBlockType,Ge=wp.i18n.__,Me=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({title:Ge("Personalized Content","altis-experiments"),description:Ge("Deliver personalized content to different audiences","altis-experiments"),keywords:[Ge("experience","altis-experiments"),Ge("personalize","altis-experiments"),Ge("conditional","altis-experiments"),Ge("audience","altis-experiments"),Ge("analytics","altis-experiments")],edit:xe,save:Oe},Te.settings);Fe(Te.name,Me)}]));